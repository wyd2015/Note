# IO多路复用的设计思路

## 1、IO多路复用要解决的问题

**如何从监听的多个socket中筛选出能够执行读写操作（有事件触发）的socket**。



要解决这个问题，需要了解从`硬件网卡`到`软件逻辑`的过程：

1. 网卡接收到网络数据包；

2. 网卡向CPU发送中断命令；

3. CPU执行中断函数，根据端口找到socket，触发对应的socket逻辑。

   

**实现IO多路复用的关键点**

socket被`中断函数`主动触发的过程。

## 2、IO多路复用的实现方式

### 2.1、select

select作为第一个解决方案比较粗糙，但能用。其实现思路为：

1. 把需要监听的socket集合全部复制到内核中；
2. 遍历socket集合，如果socket的接收缓冲区有数据，就认为该socket是可读的，把该socket返回用户进程；
3. 如果没有可读的socket，则需要在遍历时，在每个socket上预先设置被触发时需要调用的逻辑：唤醒进程和遍历socket集合；
4. 阻塞进程；
5. 当有一个socket接收到数据被触发时，会调用预先设置好的唤醒进程的逻辑和遍历socket集合的逻辑，找出可读的socket，移除这个socket上的触发逻辑，返回用户进程。

select的核心原理：不断的遍历socket，找到可读的，