# mysql事务

## 一、什么是事务

事务是应用程序中一系列严密的操作，所有操作都必须成功完成，否则所有操作的更改结果都会被撤销。一个事务中的一系列操作要么全部完成，要么全部失败。

事务结束有两种：

- 事务中的所有步骤全部成功执行，事务提交；
- 如果其中一个步骤失败，事务回滚。

## 二、事务的AICD

事务的四个特征：

- 原子性（`Atomicity`）：数据库的逻辑工作单位，事务中包含的操作要么全部成功，要么全部失败；
- 一致性（`Consistency`）：事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。如果数据库系统运行时发生故障，有些事务尚未完成就被迫中断，并且这些未完成事务对数据库所做的修改有一部分已经写入到数据库中，此时数据库就处于一种不正确的状态（数据不一致）；
- 隔离性（`Isolation`）：一个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务之间不能互相干扰；
- 持久性（`Durability`）：一个事务一旦提交，它对数据库中数据的修改是永久性的。

## 三、4种隔离级别

SQL标准定义了4类隔离级别，包括一些具体规则，用于限定事务内外的哪些改变是可见的，哪些是不可见的。低级别的隔离级一般支持更高的并发处理，且拥有更低的系统开销。

### 1、读未提交

也叫`脏读`，在这个隔离级别下，所有事务都可以看到其它未提交事务的执行结果。很少用。

### 2、读提交内容

也叫`不可重复读`。大多数数据库默认的隔离级别，但MySQL默认的隔离级别的不是这个。一个事务只能看见已提交的事务所作的改变。同一事务的其它实例在该实例处理期间可能会有新的提交，同一select可能返回不同结果。

### 3、可重读

MySQL默认隔离级别。它确保同一事务的多个实例在并发读取数据时会看到同样的数据行。